
#
# rules for the variables and values

# can be used to extract entities (e.g., crops and fertilizers) not in the lexicon
# using nouns instead of noun phrases to avoid capturing modifiers; downside: missing parts of compound entities
- name: noun-rule
  priority: ${lowpriority}
  label: Noun
  type: token
  pattern: |
    [tag=/^NN/]

### These will act as variables in various assignment events ###
- name: generic-crop-rule
  priority: ${rulepriority}
  label: GenericCrop
  type: token
  pattern: |
    [lemma = /(?i)\b(crop|cultivar|cultivation|seed|variety|varieties)\b/]

# manure --> can be added for generic fertilizer.
- name: generic-fertilizer-rule
  priority: ${rulepriority}
  label: GenericFertilizer
  type: token
  pattern: |
    /(?i)fertilizer/

- name: nominal-sowing
  priority: ${rulepriority}
  label: Planting
  type: token
  pattern: |
    ([lemma=/early|late/])? /(?i)(^planting|sowing|seeding)/ /date|season|time|timing/?

- name: verbal-sowing
  priority: ${rulepriority}
  label: Planting
  type: token
  pattern: |
    [lemma = /plant|sow|seed/  & tag = /^VB/] 

- name: variable-area
  priority: ${rulepriority}
  label: Area
  type: token
  pattern: |
    ([lemma=/cultivate|plant|sow/])? [lemma=/area/] ([lemma=/sow/])?

- name: variable-fertilizer
  priority: ${rulepriority}
  label: FertilizerUse
  type: token
  pattern: |
    /(?i)fertilizer/ /use|usage|application/ | /(?i)input/

- name: yield-rule
  priority: ${rulepriority}
  label: Yield
  type: token
  pattern: |
    [lemma = "yield" & tag = /^NN/]

- name: variable-bird-attacks
  priority: ${rulepriority}
  label: BirdAttack
  type: token
  pattern: |
    /(?i)(^bird|avian)/ [lemma=/attack/]

### Values ###

- name: value-from-date
  priority: ${rulepriority}
  label: Date
  type: token
  pattern: |
    [entity='B-DATE' & !mention=Avoid] [entity='I-DATE']* 

- name: value-from-date-2
  priority: ${rulepriority}
  label: Months
  type: token
  pattern: |
    [entity='B-DATE' & !word=/^1\d\d\d|2\d\d\d/] [entity='I-DATE' & !word=/^1\d\d\d|2\d\d\d/]* | [entity='B-DATE-RANGE' & !word=/^1\d\d\d|2\d\d\d/] [entity='I-DATE-RANGE' & !word=/^1\d\d\d|2\d\d\d/]*

- name: value-from-daterange
  priority: ${rulepriority}
  label: DateRange
  type: token
  pattern: |
    [entity='B-DATE-RANGE'] [entity='I-DATE-RANGE']*

# fixme: should be handled in processors
- name: date-two-years
  priority: ${rulepriority}
  label: Date
  type: token
  example: "The areas sown for this 2021/2022 wintering campaign are..."
  pattern: |
    [word = /^(\d\d){1,2}(\/|_)(\d\d){1,2}$/]

- name: measurement-rule
  priority: ${rulepriority}
  label: Quantity
  type: token
  action: appropriateMeasurement
  pattern: |
    [entity='B-MEASUREMENT'] [entity = 'I-MEASUREMENT']*

#- name: measurement-rule-mg
#  priority: ${rulepriority}
#  label: Quantity
#  type: token
#  example: "P and K concentrations in irrigation and floodwater were estimated at 0.1 mg P l-1 and 3.2 mg K l-1"
#  pattern: |
#    /(?i)(l-)/ [lemma=0-9]

- name: area-size-entity-rule
  priority: ${rulepriority}
  label: AreaSize
  type: token
  action: appropriateMeasurement
  pattern: |
    (?<![word = /^vs\.?|against|compared|^forecast/][word=/\w*/]{0,3}) [entity='B-MEASUREMENT' & !word = "-"] [entity='I-MEASUREMENT']*


- name: percentage-rule
  priority: ${rulepriority}
  label: Percentage
  type: token
  pattern: |
    [entity='B-PERCENTAGE'] [entity='I-PERCENTAGE']* 

### These are not Value tbms, but they will be used as value args in assignment events
- name: fertilizer-values-from-lexicon
  priority: ${rulepriority}
  label: Fertilizer
  type: token
  pattern: |
    [entity='B-FERTILIZER'] [entity='I-FERTILIZER']*

- name: crop-values-from-lexicon-vars
  priority: ${rulepriority}
  label: Crop
  type: token
  pattern: |
    [entity='B-CROP'] [entity='I-CROP']*

- name: wet-season
  priority: ${rulepriority}
  label: WetSeason
  type: token
  pattern: |
    /(?i)(wet|rainy)/ []{,2}? [lemma = /\bseason\b/]

- name: dry-season
  priority: ${rulepriority}
  label: DrySeason
  type: token
  pattern: |
    /(?i)(dry|hot|cold)/ []*? [lemma = /\bseason\b/]

- name: complex-date
  priority: ${higherpriority}
  label: DateRange
  type: token
  pattern: |
    @Value "/" @Value ("/" @Value)?

### These are used for identifying context

- name: location-vars
  priority: ${rulepriority}
  label: Location
  type: token
  pattern: |
    [entity='B-LOC'] [entity='I-LOC']*

- name: duration-property
  priority: ${rulepriority}
  label: Duration
  type: token
  pattern: |
    /(?i)(^short|medium)/ [lemma=/duration/]

- name: grain-property
  priority: ${rulepriority}
  label: GrainProperty
  type: token
  pattern: |
    /(?i)(^bold|slender)/ [lemma=/grain/]
